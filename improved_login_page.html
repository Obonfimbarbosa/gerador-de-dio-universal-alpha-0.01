<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login e Cadastro</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
    }

    .container {
      width: 90%;
      max-width: 450px;
      background: #fff;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
      font-size: 28px;
      font-weight: 600;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      font-size: 14px;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }

    .input-group input, .input-group select {
      width: 100%;
      padding: 12px 15px;
      font-size: 16px;
      border: 2px solid #e1e8ed;
      border-radius: 8px;
      background: #fafbfc;
      transition: all 0.3s ease;
    }

    .input-group input:focus, .input-group select:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .document-type {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .document-type label {
      flex: 1;
      text-align: center;
      padding: 10px;
      border: 2px solid #e1e8ed;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 0;
      background: #fafbfc;
    }

    .document-type input[type="radio"] {
      display: none;
    }

    .document-type input[type="radio"]:checked + label {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .error {
      color: #dc3545;
      font-size: 12px;
      margin-top: 6px;
      font-weight: 500;
    }

    .success {
      color: #28a745;
      font-size: 12px;
      margin-top: 6px;
      font-weight: 500;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .actions a {
      color: #667eea;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
    }

    .actions a:hover {
      text-decoration: underline;
    }

    button {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    .switch {
      text-align: center;
      margin-top: 25px;
      color: #666;
    }

    .switch a {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
    }

    .switch a:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none;
    }

    .password-requirements {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
      line-height: 1.4;
    }

    .password-requirements.valid {
      color: #28a745;
    }

    /* Recuperação de senha */
    .forgot-form {
      text-align: center;
    }

    .forgot-form p {
      color: #666;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .back-link {
      text-align: center;
      margin-top: 20px;
    }

    .back-link a {
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
    }

    .back-link a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="form-title">Login</h2>

    <!-- Login Form -->
    <form id="login-form">
      <div class="input-group">
        <label for="login-document">CPF ou CNPJ</label>
        <input type="text" id="login-document" placeholder="Digite seu CPF ou CNPJ" maxlength="18" />
        <div class="error" id="loginDocumentError"></div>
      </div>
      <div class="input-group">
        <label for="login-password">Senha</label>
        <input type="password" id="login-password" placeholder="Digite sua senha" />
        <div class="error" id="loginPasswordError"></div>
      </div>
      <button type="submit">Entrar</button>
      <div class="actions">
        <a href="#" id="forgot-password-link">Esqueceu a senha?</a>
      </div>
    </form>

    <!-- Cadastro -->
    <form id="register-form" class="hidden">
      <div class="input-group">
        <label for="register-name">Nome Completo</label>
        <input type="text" id="register-name" placeholder="Digite seu nome completo" />
        <div class="error" id="nameError"></div>
      </div>

      <div class="input-group">
        <label>Tipo de Documento</label>
        <div class="document-type">
          <input type="radio" id="cpf-type" name="doc-type" value="cpf" checked>
          <label for="cpf-type">CPF</label>
          <input type="radio" id="cnpj-type" name="doc-type" value="cnpj">
          <label for="cnpj-type">CNPJ</label>
        </div>
      </div>

      <div class="input-group">
        <label for="register-document">CPF ou CNPJ</label>
        <input type="text" id="register-document" placeholder="Digite seu CPF" maxlength="14" />
        <div class="error" id="documentError"></div>
        <div class="success" id="documentSuccess"></div>
      </div>

      <div class="input-group">
        <label for="register-email">E-mail</label>
        <input type="email" id="register-email" placeholder="Digite seu e-mail" />
        <div class="error" id="emailError"></div>
      </div>

      <div class="input-group">
        <label for="register-password">Senha</label>
        <input type="password" id="register-password" placeholder="Crie uma senha" />
        <div class="error" id="passwordError"></div>
        <div class="password-requirements" id="passwordRequirements">
          Mínimo 6 caracteres, pelo menos 1 número e 1 letra
        </div>
      </div>

      <div class="input-group">
        <label for="confirm-password">Confirmar Senha</label>
        <input type="password" id="confirm-password" placeholder="Confirme sua senha" />
        <div class="error" id="confirmPasswordError"></div>
      </div>

      <button type="submit">Cadastrar</button>
    </form>

    <!-- Recuperação de senha -->
    <form id="forgot-form" class="hidden forgot-form">
      <p>Digite seu e-mail para receber o link de recuperação:</p>
      <div class="input-group">
        <label for="forgot-email">E-mail</label>
        <input type="email" id="forgot-email" placeholder="Digite seu e-mail" />
        <div class="error" id="forgotEmailError"></div>
        <div class="success" id="forgotEmailSuccess"></div>
      </div>
      <button type="submit">Enviar Link</button>
      <div class="back-link">
        <a href="#" id="back-to-login">Voltar ao login</a>
      </div>
    </form>

    <div class="switch" id="switch-container">
      <span id="switch-text">Não tem uma conta? <a href="#" id="switch-link">Cadastre-se</a></span>
    </div>
  </div>

  <script>
    // Simulação de base de dados (sem localStorage para compatibilidade)
    let users = [];

    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const forgotForm = document.getElementById('forgot-form');
    const switchLink = document.getElementById('switch-link');
    const forgotPasswordLink = document.getElementById('forgot-password-link');
    const backToLoginLink = document.getElementById('back-to-login');
    const formTitle = document.getElementById('form-title');
    const switchText = document.getElementById('switch-text');
    const switchContainer = document.getElementById('switch-container');

    // Funções de validação
    function formatCPF(cpf) {
      return cpf.replace(/\D/g, '').replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    }

    function formatCNPJ(cnpj) {
      return cnpj.replace(/\D/g, '').replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
    }

    function validateCPF(cpf) {
      cpf = cpf.replace(/\D/g, '');
      if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
      
      let sum = 0;
      for (let i = 0; i < 9; i++) {
        sum += parseInt(cpf.charAt(i)) * (10 - i);
      }
      let remainder = (sum * 10) % 11;
      if (remainder === 10 || remainder === 11) remainder = 0;
      if (remainder !== parseInt(cpf.charAt(9))) return false;
      
      sum = 0;
      for (let i = 0; i < 10; i++) {
        sum += parseInt(cpf.charAt(i)) * (11 - i);
      }
      remainder = (sum * 10) % 11;
      if (remainder === 10 || remainder === 11) remainder = 0;
      return remainder === parseInt(cpf.charAt(10));
    }

    function validateCNPJ(cnpj) {
      cnpj = cnpj.replace(/\D/g, '');
      if (cnpj.length !== 14 || /^(\d)\1{13}$/.test(cnpj)) return false;
      
      const weights1 = [5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];
      const weights2 = [6, 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];
      
      let sum = 0;
      for (let i = 0; i < 12; i++) {
        sum += parseInt(cnpj.charAt(i)) * weights1[i];
      }
      let remainder = sum % 11;
      const digit1 = remainder < 2 ? 0 : 11 - remainder;
      if (digit1 !== parseInt(cnpj.charAt(12))) return false;
      
      sum = 0;
      for (let i = 0; i < 13; i++) {
        sum += parseInt(cnpj.charAt(i)) * weights2[i];
      }
      remainder = sum % 11;
      const digit2 = remainder < 2 ? 0 : 11 - remainder;
      return digit2 === parseInt(cnpj.charAt(13));
    }

    function validateDocument(document) {
      const cleaned = document.replace(/\D/g, '');
      if (cleaned.length === 11) {
        return validateCPF(cleaned);
      } else if (cleaned.length === 14) {
        return validateCNPJ(cleaned);
      }
      return false;
    }

    function formatDocument(document) {
      const cleaned = document.replace(/\D/g, '');
      if (cleaned.length <= 11) {
        return formatCPF(cleaned);
      } else {
        return formatCNPJ(cleaned);
      }
    }

    function validateEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function validatePassword(password) {
      return password.length >= 6 && /[A-Za-z]/.test(password) && /\d/.test(password);
    }

    // Formatação automática dos documentos
    function setupDocumentFormatting(inputId) {
      const input = document.getElementById(inputId);
      input.addEventListener('input', function(e) {
        e.target.value = formatDocument(e.target.value);
      });
    }

    setupDocumentFormatting('login-document');
    setupDocumentFormatting('register-document');

    // Atualizar placeholder e maxlength baseado no tipo
    document.querySelectorAll('input[name="doc-type"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const documentInput = document.getElementById('register-document');
        if (this.value === 'cpf') {
          documentInput.placeholder = 'Digite seu CPF';
          documentInput.maxLength = 14;
        } else {
          documentInput.placeholder = 'Digite seu CNPJ';
          documentInput.maxLength = 18;
        }
        documentInput.value = '';
        clearFieldError('documentError');
        clearFieldError('documentSuccess');
      });
    });

    // Validação em tempo real do documento no cadastro
    document.getElementById('register-document').addEventListener('input', function(e) {
      clearFieldError('documentError');
      clearFieldError('documentSuccess');
      
      if (e.target.value.length > 0) {
        const isValid = validateDocument(e.target.value);
        const cleanedDoc = e.target.value.replace(/\D/g, '');
        
        if (isValid) {
          showSuccess('documentSuccess', 'Documento válido!');
        } else if (cleanedDoc.length >= 11) {
          showError('documentError', 'Documento inválido!');
        }
      }
    });

    // Validação em tempo real da senha
    document.getElementById('register-password').addEventListener('input', function(e) {
      const password = e.target.value;
      const requirements = document.getElementById('passwordRequirements');
      
      if (password.length === 0) {
        requirements.textContent = 'Mínimo 6 caracteres, pelo menos 1 número e 1 letra';
        requirements.className = 'password-requirements';
      } else if (validatePassword(password)) {
        requirements.textContent = '✓ Senha válida';
        requirements.className = 'password-requirements valid';
      } else {
        requirements.textContent = 'Senha deve ter pelo menos 6 caracteres, 1 número e 1 letra';
        requirements.className = 'password-requirements';
      }
    });

    function showError(id, message) {
      const element = document.getElementById(id);
      element.textContent = message;
      element.style.display = 'block';
    }

    function showSuccess(id, message) {
      const element = document.getElementById(id);
      element.textContent = message;
      element.style.display = 'block';
    }

    function clearFieldError(id) {
      const element = document.getElementById(id);
      element.textContent = '';
      element.style.display = 'none';
    }

    function clearAllErrors() {
      ['nameError', 'documentError', 'documentSuccess', 'emailError', 'passwordError', 
       'confirmPasswordError', 'loginDocumentError', 'loginPasswordError',
       'forgotEmailError', 'forgotEmailSuccess'].forEach(id => clearFieldError(id));
    }

    // Navegação entre formulários
    function showLoginForm() {
      loginForm.classList.remove('hidden');
      registerForm.classList.add('hidden');
      forgotForm.classList.add('hidden');
      switchContainer.classList.remove('hidden');
      formTitle.textContent = 'Login';
      switchText.innerHTML = 'Não tem uma conta? <a href="#" id="switch-link">Cadastre-se</a>';
      document.getElementById('switch-link').addEventListener('click', toggleForm);
      clearAllErrors();
    }

    function showRegisterForm() {
      loginForm.classList.add('hidden');
      registerForm.classList.remove('hidden');
      forgotForm.classList.add('hidden');
      switchContainer.classList.remove('hidden');
      formTitle.textContent = 'Cadastro';
      switchText.innerHTML = 'Já tem uma conta? <a href="#" id="switch-link">Entrar</a>';
      document.getElementById('switch-link').addEventListener('click', toggleForm);
      clearAllErrors();
    }

    function showForgotForm() {
      loginForm.classList.add('hidden');
      registerForm.classList.add('hidden');
      forgotForm.classList.remove('hidden');
      switchContainer.classList.add('hidden');
      formTitle.textContent = 'Recuperar Senha';
      clearAllErrors();
    }

    function toggleForm(e) {
      e.preventDefault();
      if (loginForm.classList.contains('hidden')) {
        showLoginForm();
      } else {
        showRegisterForm();
      }
    }

    // Event listeners
    document.addEventListener('click', function(e) {
      if (e.target && e.target.id === 'switch-link') {
        toggleForm(e);
      }
    });

    forgotPasswordLink.addEventListener('click', function(e) {
      e.preventDefault();
      showForgotForm();
    });

    backToLoginLink.addEventListener('click', function(e) {
      e.preventDefault();
      showLoginForm();
    });

    // Cadastro
    registerForm.addEventListener('submit', function (e) {
      e.preventDefault();
      clearAllErrors();

      const name = document.getElementById('register-name').value.trim();
      const documentValue = document.getElementById('register-document').value.trim();
      const email = document.getElementById('register-email').value.trim();
      const password = document.getElementById('register-password').value.trim();
      const confirmPassword = document.getElementById('confirm-password').value.trim();

      let isValid = true;

      if (name === '' || name.length < 2) {
        showError('nameError', 'Nome deve ter pelo menos 2 caracteres.');
        isValid = false;
      }

      if (documentValue === '') {
        showError('documentError', 'Documento é obrigatório.');
        isValid = false;
      } else if (!validateDocument(documentValue)) {
        showError('documentError', 'Documento inválido.');
        isValid = false;
      } else {
        const cleanDocument = documentValue.replace(/\D/g, '');
        if (users.some(user => user.document === cleanDocument)) {
          showError('documentError', 'Documento já cadastrado.');
          isValid = false;
        }
      }

      if (email === '') {
        showError('emailError', 'E-mail é obrigatório.');
        isValid = false;
      } else if (!validateEmail(email)) {
        showError('emailError', 'E-mail inválido.');
        isValid = false;
      } else if (users.some(user => user.email === email)) {
        showError('emailError', 'E-mail já cadastrado.');
        isValid = false;
      }

      if (password === '') {
        showError('passwordError', 'Senha é obrigatória.');
        isValid = false;
      } else if (!validatePassword(password)) {
        showError('passwordError', 'Senha deve ter pelo menos 6 caracteres, 1 número e 1 letra.');
        isValid = false;
      }

      if (confirmPassword === '') {
        showError('confirmPasswordError', 'Confirmação de senha é obrigatória.');
        isValid = false;
      } else if (password !== confirmPassword) {
        showError('confirmPasswordError', 'Senhas não conferem.');
        isValid = false;
      }

      if (isValid) {
        const cleanDocument = documentValue.replace(/\D/g, '');
        const newUser = { 
          name, 
          document: cleanDocument, 
          email, 
          password 
        };
        users.push(newUser);
        alert('Cadastro realizado com sucesso!');
        registerForm.reset();
        document.getElementById('passwordRequirements').textContent = 'Mínimo 6 caracteres, pelo menos 1 número e 1 letra';
        document.getElementById('passwordRequirements').className = 'password-requirements';
        showLoginForm();
      }
    });

    // Login
    loginForm.addEventListener('submit', function (e) {
      e.preventDefault();
      clearAllErrors();

      const loginDocument = document.getElementById('login-document').value.trim();
      const loginPassword = document.getElementById('login-password').value.trim();

      let isValid = true;

      if (loginDocument === '') {
        showError('loginDocumentError', 'CPF ou CNPJ é obrigatório.');
        isValid = false;
      } else if (!validateDocument(loginDocument)) {
        showError('loginDocumentError', 'CPF ou CNPJ inválido.');
        isValid = false;
      }

      if (loginPassword === '') {
        showError('loginPasswordError', 'Senha é obrigatória.');
        isValid = false;
      }

      if (isValid) {
        const cleanDocument = loginDocument.replace(/\D/g, '');
        const user = users.find(user => user.document === cleanDocument && user.password === loginPassword);

        if (user) {
          alert(`Bem-vindo, ${user.name}!`);
          // window.location.href = "index.html"; // descomente para redirecionar
        } else {
          showError('loginDocumentError', 'CPF/CNPJ ou senha incorretos.');
        }
      }
    });

    // Recuperação de senha
    forgotForm.addEventListener('submit', function(e) {
      e.preventDefault();
      clearAllErrors();

      const email = document.getElementById('forgot-email').value.trim();

      if (email === '') {
        showError('forgotEmailError', 'E-mail é obrigatório.');
        return;
      }

      if (!validateEmail(email)) {
        showError('forgotEmailError', 'E-mail inválido.');
        return;
      }

      const user = users.find(user => user.email === email);
      if (!user) {
        showError('forgotEmailError', 'E-mail não encontrado.');
        return;
      }

      showSuccess('forgotEmailSuccess', 'Link de recuperação enviado para seu e-mail!');
      document.getElementById('forgot-email').value = '';
    });
  </script>
</body>
</html>